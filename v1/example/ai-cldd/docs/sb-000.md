SB-ID: SB-000
SB-TYPE: SYSTEM_BASE
VERSION: 1.0
AUTHOR: Paulo CÃ©sar Medeiros Porto
CREATED_AT: 2026-01-25

SYSTEM OVERVIEW
This system is responsible for maintaining the current game state during live matches.
The game client periodically sends state updates to the server.

The server must:
- Share the current game state with all connected players
- Receive player answers
- Calculate player scores based on received answers

The system acts as the single source of truth for the game state during a match.

TECHNOLOGIES
The system MUST be built using the following technologies:
- Node.js v24
Purpose: Runtime environment
- TypeScript
Purpose: Strongly typed development language
Requirement: Code must be written in TypeScript and transpiled using the tsc compiler
- Fastify
Purpose: HTTP server and endpoint handling
- AJV (Fastify built-in)
Purpose: Request body validation
- redis-node
Purpose: Persist game state, player answers, and player scores in Redis

All FEATURE UCs MUST use these technologies unless a newer SYSTEM_BASE explicitly overrides them.

CONSTRAINTS AND HARD RULES
The following rules MUST NOT be violated:
- All API responses MUST be in JSON format
- Fastify MUST be used for all HTTP endpoints
- AJV validation MUST be applied to all request bodies that accept input
- Redis MUST be used as the persistence layer for game state and scores
- If there is any conflict between a FEATURE UC and this SYSTEM_BASE UC,
this SYSTEM_BASE UC takes precedence unless explicitly stated otherwise

AI agents MUST respect all constraints, technologies, and patterns defined in this document.

BUILD AND RUNTIME CONFIGURATION
The system MUST support the following execution modes:
Development:
- The project MUST be executable using ts-node for local development
Build:
- The build process MUST use the TypeScript compiler (tsc)
Runtime:
- npm start MUST execute the compiled entry point at:
build/src/index.js

GLOBAL ARCHITECTURAL PATTERNS
- The system MUST follow Domain Driven Design (DDD) principles.
- Separation of responsibilities is mandatory and must be enforced through package structure.
- Business rules MUST be isolated from transport and persistence layers.

PROJECT STRUCTURE
The project MUST follow the structure below:
- src/routes
Responsibility: HTTP routes and endpoints
Naming rule: {domain}_{version}_route.ts
- src/core
Responsibility: Business rules and domain logic
- src/types
Responsibility:
Redis persistence types
Request and response types
Types must be organized by namespaces
- src/repo
Responsibility: Data persistence logic
- src/index.ts
Responsibility: Application entry point
- src/app.ts
Responsibility: Server initialization logic

No FEATURE UC may introduce structural changes that violate this layout.

HTTP AND COMMUNICATION STANDARDS
Allowed response formats:
- JSON only

HTTP status code conventions:
- 200: Successful requests that return data
- 204: Successful requests with no response body
- 400: Missing or invalid required fields
- 403: Security or authorization failures
- 500: Unexpected internal server errors

Default error response structure:

{
error: string
}

The error field MUST contain a machine-readable error identifier, such as:
- INTERNAL_SERVER_ERROR
- FAIL_TO_CONNECT_TO_DATABASE
- UNAUTHORIZED